[⏏️ 메인으로](https://github.com/IgnacioSEO/TIL/tree/main/Wecode#table-of-contents)

# 1. Validate Token Middleware

## 1-1. Middleware

#### Middleware는 Express 서버의 라이프 사이클에서 요청과 응답 중간에서 목적에 맞게 기능을 처리하는 함수 입니다. Express.js는 내장 Middleware를 제공 하기도 하지만, 사용자가 원하는 특정 작업을 수행하게 할 수 있게 사용자가 직접 Middleware를 정의 할 수 있습니다.

#### Middleware를 직접 정의 할 때는 3개의 인자를 받아야 합니다. 그리고 next() 함수를 통해 다음 middleware가 호출이 되어야 합니다.

```javascript
const myCustomMiddleware = async(req, res, next) => {
    ...

    next()
}
```

#### req: HTTP request 객체

#### res: HTTP response 객체

#### next: 다음 middleware 호출 함수

## 1-2 Validate Token Middleware

#### Cunstom Middleware을 관리하기 위해 middleware 디렉토리를 만들고 auth.js 파일을 만듭니다. 아래 구조를 참고해서 JWT를 검증하는 Middleware을 작성해 보세요.

```javascript
const validateToken = async (req, res, next) => {
    try {
        const token = req.headers.authorization; // (1)

	. . . // (2)

	next(); // (3)
    } catch (err) {
        next(err);
    }
};
```

#### (1): request의 headers에서 token 가져오기

#### (2): token 검증 코드 작성

#### (3): 검증 완료 후 다음 middleware 실행

## 1-3. Router에 Middleware 추가

### 1-3-1. 기본 router

```javascript
const express = require("express");
const router = express.Router();

const { postController } = require("../controllers");

router.post("", postController.createPost);
module.exports = router;
```

### 1-3-2. Middleware 추가

#### 기본 router에서 두번째 인자로 실행할 Controller을 넣어줬다면, Middleware을 추가 할 때는 두번째 인자로 Middlesware 함수를 넣어 줍니다. 그리서 세번째 인자로 실행할 Controller을 넣어주면 됩니다.

```javascript
const express = require("express");
const router = express.Router();
import { validateToken } from "../middlewares/auth";

const { postController } = require("../controllers");

router.post("", validateToken, postController.createPost);
module.exports = router;
```

# 2. Summary

#### Middleware는 Express 서버의 라이프 사이클에서 요청과 응답 중간에서 목적에 맞게 기능을 처리하는 함수 입니다.

#### 기본으로 제공하는 내장 Middleware뿐만 아니라 사용자가 원하는 특정 작업을 수행하게 할 수 있게 사용자가 직접 Middleware를 정의할 수 있습니다.

#### Middleware를 직접 정의 할 때는 request, response, next를 인자로 받아야 하며 next() 함수를 통해 다음 Middleware를 호출 합니다.

#### Token을 검증하는 Custom Middleware를 만들어 로그인을 한 사용자만 이용할 수 있는 함수를 실행하기 전에 인증 절차를 진행 할 수 있습니다.

#### Router에 token을 검증하는 Middleware을 추가하여 Router Middleware → Token 검증 Middleware → Controller 순으로 코드를 진행 할 수 있습니다.

[⏏️ 메인으로](https://github.com/IgnacioSEO/TIL/tree/main/Wecode#table-of-contents)
